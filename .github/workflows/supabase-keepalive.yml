# ---------------------------------------------------------------------------
# Supabase Keep-Alive Ping
# ---------------------------------------------------------------------------
# Supabase 무료 티어는 1주 비활성 시 프로젝트를 자동 중지합니다.
# 3일마다 REST 엔드포인트에 ping을 보내 프로젝트를 깨워둡니다.
#
# 필요한 Repository Secrets:
#   SUPABASE_URL      — https://xxxxx.supabase.co
#   SUPABASE_ANON_KEY — eyJhbGciOi...

name: Supabase Keep-Alive

on:
  schedule:
    - cron: '0 9 */3 * *' # 매 3일 09:00 UTC
  workflow_dispatch: # 수동 트리거

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Supabase REST endpoint
        run: |
          STATUS=$(curl -sf \
            "${{ secrets.SUPABASE_URL }}/rest/v1/" \
            -H "apikey: ${{ secrets.SUPABASE_ANON_KEY }}" \
            -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}" \
            -o /dev/null -w "%{http_code}")
          echo "Supabase responded with HTTP $STATUS"
          if [ "$STATUS" -ne 200 ]; then
            echo "::warning::Supabase returned non-200 status: $STATUS"
            exit 1
          fi
